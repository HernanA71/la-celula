<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La C√©lula: Aprende y Eval√∫a</title>
    <!-- Fuente Inter de Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap">
    <style>
        :root {
            --primary-color: #6a0dad; /* P√∫rpura */
            --secondary-color: #ffc107; /* Amarillo */
            --accent-color: #00bcd4; /* Cian */
            --bg-color: #f3f4f6; /* Gris claro */
            --text-color: #1f2937; /* Gris oscuro */
            --card-bg: #ffffff; /* Blanco */
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            transition: background-color 0.5s ease-in-out;
        }

        .container {
            background-color: var(--card-bg);
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            max-width: 90vw;
            width: 100%;
            margin: 1rem;
            box-sizing: border-box;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.8s forwards;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        h2 {
            color: var(--primary-color);
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        p {
            font-size: 1rem;
            line-height: 1.6;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            text-decoration: none;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            font-size: 1rem;
        }
        
        .btn:hover {
            background-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-navigation {
            background-color: #e5e7eb;
            color: #4b5563;
        }
        .btn-navigation:hover {
            background-color: #d1d5db;
            color: #1f2937;
        }
        
        /* Estilos espec√≠ficos de la pantalla de inicio */
        #start-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .welcome-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .welcome-content h1 {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .welcome-content p {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            max-width: 600px;
        }
        
        .start-illustration {
            width: 100%;
            max-width: 300px;
            height: auto;
            margin-bottom: 2rem;
            animation: zoomIn 1s forwards;
        }

        @keyframes zoomIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @media (min-width: 768px) {
            .welcome-content {
                flex-direction: row;
                text-align: left;
            }
            .welcome-text {
                flex: 1;
                padding-right: 2rem;
            }
            .start-illustration {
                margin-bottom: 0;
            }
        }

        /* Estilos espec√≠ficos de las secciones */
        #study-zone, #evaluation-form, #quiz-zone, #results-screen {
            display: none;
        }

        .study-point {
            background-color: var(--bg-color);
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 1rem;
            text-align: left;
            display: none; /* Oculta todas las p√°ginas por defecto */
            flex-direction: column;
            align-items: center;
        }

        .study-point.active {
            display: flex;
        }

        .study-point h3 {
            color: var(--accent-color);
            margin-top: 0;
            display: flex;
            align-items: center;
            font-size: 1.25rem;
        }

        .study-point h3 span {
            font-size: 2rem;
            margin-right: 0.5rem;
        }

        .study-point .content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .study-point .text-content {
            flex: 1;
            margin-right: 1rem;
            text-align: left;
        }

        .study-point .illustration {
            width: 100%;
            max-width: 150px;
            height: auto;
            margin-top: 1rem;
        }
        
        @media (min-width: 768px) {
            .study-point .content {
                flex-direction: row;
                align-items: flex-start;
            }

            .study-point .illustration {
                margin-top: 0;
                margin-left: 1rem;
            }
        }

        .input-group {
            margin-bottom: 1rem;
            text-align: left;
        }

        .input-group label {
            font-weight: bold;
            display: block;
            margin-bottom: 0.5rem;
        }

        .input-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            box-sizing: border-box;
        }

        .question-card {
            background-color: var(--bg-color);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 1rem;
            text-align: left;
            border: 2px solid transparent;
            transition: border-color 0.3s ease;
        }

        .question-card.correct {
            border-color: #28a745;
        }
        .question-card.incorrect {
            border-color: #dc3545;
        }

        .question-options label {
            display: block;
            background-color: white;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid #e5e7eb;
        }

        .question-options label:hover {
            background-color: #f3f4f6;
        }

        .question-options input[type="radio"] {
            margin-right: 0.75rem;
            accent-color: var(--primary-color);
        }
        
        .feedback {
            font-size: 0.9rem;
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.5rem;
        }
        .feedback.correct {
            background-color: #d4edda;
            color: #155724;
        }
        .feedback.incorrect {
            background-color: #f8d7da;
            color: #721c24;
        }
        .feedback p {
            margin: 0;
        }

        /* Responsive Design */
        @media (min-width: 768px) {
            .container {
                padding: 3rem;
                max-width: 700px;
            }
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: var(--primary-color);
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Estilos para el modal personalizado */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 90%;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- Pantalla de inicio -->
        <div id="start-screen">
            <div class="welcome-content">
                <div class="welcome-text">
                    <h1>Explorando La C√©lula üî¨</h1>
                    <p>¬°Hola! ¬°Prep√°rate para un viaje incre√≠ble para conocer la unidad fundamental de la vida!</p>
                    <button id="start-btn" class="btn">Comenzar</button>
                </div>
                <!-- Nueva ilustraci√≥n SVG m√°s detallada y grande -->
                <svg class="start-illustration" viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg">
                    <!-- Fondo de la c√©lula -->
                    <circle cx="200" cy="150" r="120" fill="#a7c957" stroke="#87a937" stroke-width="5" opacity="0.8"/>
                    
                    <!-- N√∫cleo -->
                    <circle cx="200" cy="150" r="60" fill="#800080" stroke="#6a0dad" stroke-width="3" opacity="0.9"/>
                    <circle cx="200" cy="150" r="25" fill="#c77dff" stroke="#a000c0" stroke-width="2"/>
                    
                    <!-- Mitocondrias -->
                    <ellipse cx="100" cy="100" rx="30" ry="20" fill="#ffc107" stroke="#ff8c00" stroke-width="2"/>
                    <path d="M 80 100 Q 90 90 100 100 T 120 100" fill="none" stroke="#6a0dad" stroke-width="3" opacity="0.7"/>

                    <!-- Ribosomas -->
                    <circle cx="280" cy="80" r="8" fill="#a0522d"/>
                    <circle cx="300" cy="120" r="8" fill="#a0522d"/>
                    <circle cx="150" cy="220" r="8" fill="#a0522d"/>
                    
                    <!-- Golgi -->
                    <path d="M 100 200 C 120 180, 150 180, 170 200 S 200 220, 220 200" fill="none" stroke="#e9c46a" stroke-width="4"/>
                    <path d="M 100 210 C 120 190, 150 190, 170 210 S 200 230, 220 210" fill="none" stroke="#e9c46a" stroke-width="4"/>
                    
                    <!-- Ret√≠culo Endoplasm√°tico -->
                    <path d="M 280 220 C 260 200, 240 200, 220 220 S 200 240, 180 220" fill="none" stroke="#bde0fe" stroke-width="4"/>
                    <path d="M 280 230 C 260 210, 240 210, 220 230 S 200 250, 180 230" fill="none" stroke="#bde0fe" stroke-width="4"/>
                </svg>
            </div>
        </div>

        <!-- Zona de Estudio con paginaci√≥n -->
        <div id="study-zone" style="display: none;">
            <h1>üìö Zona de Estudio</h1>
            
            <!-- P√°gina 1: Introducci√≥n y Membrana -->
            <div class="study-point" id="study-page-1">
                <div class="content">
                    <div class="text-content">
                        <h3><span>üß¨</span> La C√©lula: El Bloque de Construcci√≥n de la Vida</h3>
                        <p>Imagina que tu cuerpo es una ciudad inmensa. En esta ciudad, los ladrillos m√°s peque√±os, pero m√°s importantes, son las c√©lulas. Son la unidad b√°sica de todos los seres vivos, desde las bacterias m√°s diminutas hasta los √°rboles m√°s grandes y los humanos. Cada c√©lula es una mini-f√°brica con sus propias partes y trabajos.</p>
                        <h3><span>‚ö´</span> La Membrana Celular: El Vigilante Fronterizo</h3>
                        <p>La membrana celular es la frontera de la ciudad. Es una capa delgada y flexible que rodea la c√©lula. Su trabajo principal es proteger el interior y controlar qu√© sustancias entran y salen. Es selectiva, lo que significa que solo permite el paso de lo que la c√©lula necesita, como nutrientes, y expulsa los desechos. Es como el "portero" inteligente que decide qui√©n puede pasar y qui√©n no.</p>
                    </div>
                    <svg class="illustration" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="50" cy="50" r="40" fill="#a7c957" stroke="#87a937" stroke-width="2"/>
                        <circle cx="50" cy="50" r="15" fill="#588157" stroke="#3a5737" stroke-width="2"/>
                        <circle cx="40" cy="40" r="3" fill="#ffffff"/>
                        <circle cx="60" cy="45" r="3" fill="#ffffff"/>
                        <circle cx="55" cy="65" r="3" fill="#ffffff"/>
                        <circle cx="35" cy="60" r="3" fill="#ffffff"/>
                        <rect x="45" y="0" width="10" height="20" fill="#00bcd4" rx="5"/>
                        <rect x="45" y="80" width="10" height="20" fill="#00bcd4" rx="5"/>
                    </svg>
                </div>
            </div>

            <!-- P√°gina 2: Citoplasma y N√∫cleo -->
            <div class="study-point" id="study-page-2">
                <div class="content">
                    <div class="text-content">
                        <h3><span>üåä</span> El Citoplasma: El Espacio de Trabajo</h3>
                        <p>El citoplasma es el l√≠quido gelatinoso que llena el espacio dentro de la c√©lula. Se compone principalmente de agua, sales y prote√≠nas. Dentro de este gel, todos los organelos flotan y se mueven. Es el lugar donde ocurren muchas de las reacciones qu√≠micas importantes de la c√©lula y donde se transportan las sustancias entre los organelos.</p>
                        <h3><span>üß†</span> El N√∫cleo: El Centro de Mando</h3>
                        <p>El n√∫cleo es el cerebro de la c√©lula. Es una estructura grande y redonda que contiene el **ADN** (√°cido desoxirribonucleico), el "libro de recetas" o el manual de instrucciones completo para construir y operar la c√©lula. El n√∫cleo controla el crecimiento, la reproducci√≥n y todas las actividades celulares. Sin el n√∫cleo, la c√©lula no sabr√≠a qu√© hacer.</p>
                    </div>
                    <svg class="illustration" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <path d="M 50 10 A 40 40 0 1 1 50 90 A 40 40 0 1 1 50 10 Z" fill="#90e0ef" stroke="#00b4d8" stroke-width="2"/>
                        <circle cx="50" cy="50" r="20" fill="#800080" stroke="#6a0dad" stroke-width="2"/>
                        <circle cx="50" cy="50" r="8" fill="#c77dff"/>
                        <line x1="30" y1="50" x2="70" y2="50" stroke="#f48c06" stroke-width="2" stroke-linecap="round"/>
                        <line x1="50" y1="30" x2="50" y2="70" stroke="#f48c06" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="35" cy="40" r="8" fill="#5e60ce"/>
                        <circle cx="65" cy="60" r="10" fill="#ffc107"/>
                        <rect x="25" y="70" width="15" height="15" fill="#f48c06" rx="3"/>
                    </svg>
                </div>
            </div>

            <!-- P√°gina 3: Mitocondrias y Ribosomas -->
            <div class="study-point" id="study-page-3">
                <div class="content">
                    <div class="text-content">
                        <h3><span>‚ö°</span> Las Mitocondrias: Las Centrales El√©ctricas</h3>
                        <p>Si la c√©lula es una ciudad, las mitocondrias son sus **centrales de energ√≠a**. Toman los nutrientes que consumes (az√∫cares, grasas) y los convierten en **ATP**, la energ√≠a utilizable que la c√©lula necesita para todas sus actividades, desde el movimiento hasta la reparaci√≥n. Sin mitocondrias, las c√©lulas no tendr√≠an la energ√≠a para funcionar.</p>
                        <h3><span>üçö</span> Los Ribosomas: Los Constructores de Prote√≠nas</h3>
                        <p>Los ribosomas son peque√±as "f√°bricas" que construyen prote√≠nas siguiendo las instrucciones del ADN del n√∫cleo. Las prote√≠nas son esenciales para casi todo en la c√©lula, desde construir estructuras hasta acelerar reacciones qu√≠micas. ¬°Son como los obreros que construyen todo lo que la c√©lula necesita para sobrevivir!</p>
                    </div>
                    <svg class="illustration" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <ellipse cx="50" cy="50" rx="40" ry="25" fill="#ffc107" stroke="#ff8c00" stroke-width="2"/>
                        <path d="M 20 40 Q 30 30 50 40 T 80 40" fill="none" stroke="#6a0dad" stroke-width="4"/>
                        <path d="M 20 60 Q 30 70 50 60 T 80 60" fill="none" stroke="#6a0dad" stroke-width="4"/>
                        <circle cx="30" cy="50" r="5" fill="#ffffff"/>
                        <circle cx="70" cy="50" r="5" fill="#ffffff"/>
                        <circle cx="20" cy="20" r="4" fill="#a0522d"/>
                        <circle cx="80" cy="80" r="4" fill="#a0522d"/>
                        <circle cx="40" cy="85" r="4" fill="#a0522d"/>
                    </svg>
                </div>
            </div>

            <!-- Botones de navegaci√≥n de la Zona de Estudio -->
            <div style="display: flex; justify-content: space-between; margin-top: 1.5rem;">
                <button id="prev-btn" class="btn btn-navigation" style="display: none;">P√°gina Anterior</button>
                <button id="next-btn" class="btn btn-navigation">Siguiente P√°gina</button>
                <button id="go-to-evaluation-btn" class="btn btn-secondary" style="display: none;">Ir a la Evaluaci√≥n</button>
            </div>
        </div>

        <!-- Formulario de Evaluaci√≥n -->
        <div id="evaluation-form" style="display: none;">
            <h1>‚úèÔ∏è ¬°Es Hora de Evaluar!</h1>
            <p>Por favor, ingresa tus datos para comenzar el cuestionario.</p>
            <form id="registro-form">
                <div class="input-group">
                    <label for="student-name">Nombre completo:</label>
                    <input type="text" id="student-name" required>
                </div>
                <div class="input-group">
                    <label for="student-grade">Curso:</label>
                    <input type="text" id="student-grade" required>
                </div>
                <div class="input-group">
                    <label for="identification-number">N√∫mero de Identificaci√≥n:</label>
                    <input type="text" id="identification-number" required>
                </div>
                <button type="submit" class="btn">Acceder a la Evaluaci√≥n</button>
            </form>
        </div>

        <!-- Zona de Cuestionario -->
        <div id="quiz-zone" style="display: none;">
            <h1>‚ùì Cuestionario</h1>
            <form id="quiz-form">
                <!-- Las preguntas se generar√°n aqu√≠ con JavaScript -->
            </form>
            <button id="submit-quiz-btn" class="btn" style="margin-top: 2rem;">Enviar Respuestas</button>
        </div>

        <!-- Pantalla de Resultados -->
        <div id="results-screen" style="display: none;">
            <h1>üéâ ¬°Resultados!</h1>
            <p id="final-score">Tu puntaje es: <span></span> de 10</p>
            <p id="score-message"></p>
            <button id="new-evaluation-btn" class="btn btn-secondary">Volver al Inicio</button>
        </div>
        
        <!-- Overlay de carga -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="spinner"></div>
        </div>
        
        <!-- Modal de alerta personalizado -->
        <div id="custom-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <p id="modal-message"></p>
                <button id="modal-close-btn" class="btn">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        // Variables de los elementos del DOM
        const startScreen = document.getElementById('start-screen');
        const studyZone = document.getElementById('study-zone');
        const evaluationForm = document.getElementById('evaluation-form');
        const quizZone = document.getElementById('quiz-zone');
        const resultsScreen = document.getElementById('results-screen');
        const quizForm = document.getElementById('quiz-form');
        const loadingOverlay = document.getElementById('loading-overlay');
        const finalScoreSpan = document.querySelector('#final-score span');
        const scoreMessage = document.getElementById('score-message');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const goToEvaluationBtn = document.getElementById('go-to-evaluation-btn');
        const modal = document.getElementById('custom-modal');
        const modalMessage = document.getElementById('modal-message');
        const modalCloseBtn = document.getElementById('modal-close-btn');

        // Variables globales para los datos del estudiante
        let studentName = '';
        let studentGrade = '';
        let studentId = '';
        let currentPage = 0;
        const totalPages = 3;

        // Objeto con las preguntas y respuestas
        const questions = [
            {
                question: '¬øQu√© analog√≠a se usa para describir el papel de las mitocondrias en la c√©lula?',
                options: ['El cerebro', 'El vigilante fronterizo', 'La central el√©ctrica', 'El obrero de construcci√≥n'],
                correctAnswer: 'La central el√©ctrica'
            },
            {
                question: '¬øQu√© estructura de la c√©lula contiene las instrucciones gen√©ticas o el ADN?',
                options: ['El citoplasma', 'La membrana celular', 'El n√∫cleo', 'Los ribosomas'],
                correctAnswer: 'El n√∫cleo'
            },
            {
                question: 'Adem√°s de agua, ¬øqu√© otros componentes principales forman el citoplasma?',
                options: ['Solo sales', 'Sales y prote√≠nas', 'ADN y ARN', 'L√≠pidos y carbohidratos'],
                correctAnswer: 'Sales y prote√≠nas'
            },
            {
                question: 'La membrana celular es una "barrera selectiva". ¬øQu√© significa eso?',
                options: ['Que solo permite que pasen ciertas sustancias', 'Que no deja pasar nada', 'Que deja pasar todo lo que es l√≠quido', 'Que produce sustancias para la c√©lula'],
                correctAnswer: 'Que solo permite que pasen ciertas sustancias'
            },
            {
                question: 'Si los ribosomas son como "obreros", ¬øqu√© construyen en la c√©lula?',
                options: ['Energ√≠a', 'Membranas', 'ADN', 'Prote√≠nas'],
                correctAnswer: 'Prote√≠nas'
            },
            {
                question: '¬øCu√°l es la mol√©cula de energ√≠a que las mitocondrias producen para la c√©lula?',
                options: ['ADN', 'ATP', 'ARN', 'GLU'],
                correctAnswer: 'ATP'
            },
            {
                question: '¬øPor qu√© se dice que el n√∫cleo es el "cerebro" de la c√©lula?',
                options: ['Porque es la parte m√°s grande', 'Porque es donde se guarda el alimento', 'Porque controla todas las actividades y el crecimiento', 'Porque produce energ√≠a'],
                correctAnswer: 'Porque controla todas las actividades y el crecimiento'
            },
            {
                question: '¬øCu√°l de estos NO es un componente principal de la c√©lula?',
                options: ['N√∫cleo', 'Citoplasma', 'Mitocondrias', 'Pared de ladrillo'],
                correctAnswer: 'Pared de ladrillo'
            },
            {
                question: 'El citoplasma es el lugar donde los organelos...',
                options: ['Se guardan para dormir', 'Flotan y se mueven', 'Producen comida', 'Se replican'],
                correctAnswer: 'Flotan y se mueven'
            },
            {
                question: 'Si una c√©lula fuera una casa, la analog√≠a para el citoplasma ser√≠a:',
                options: ['Las paredes', 'El techo', 'El espacio interior lleno de muebles', 'La puerta principal'],
                correctAnswer: 'El espacio interior lleno de muebles'
            }
        ];

        // Funci√≥n para cambiar de vista
        function showView(view) {
            startScreen.style.display = 'none';
            studyZone.style.display = 'none';
            evaluationForm.style.display = 'none';
            quizZone.style.display = 'none';
            resultsScreen.style.display = 'none';
            view.style.display = 'block';
        }

        // Funci√≥n para mostrar la p√°gina actual del estudio
        function showStudyPage(pageIndex) {
            document.querySelectorAll('.study-point').forEach((page, index) => {
                page.classList.remove('active');
                if (index === pageIndex) {
                    page.classList.add('active');
                }
            });
            // Ocultar/mostrar botones de navegaci√≥n
            prevBtn.style.display = pageIndex > 0 ? 'inline-block' : 'none';
            nextBtn.style.display = pageIndex < totalPages - 1 ? 'inline-block' : 'none';
            goToEvaluationBtn.style.display = pageIndex === totalPages - 1 ? 'inline-block' : 'none';
        }

        // Generar el cuestionario din√°micamente
        function generateQuiz() {
            quizForm.innerHTML = ''; // Limpiar preguntas anteriores
            questions.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <h4>${index + 1}. ${q.question}</h4>
                    <div class="question-options">
                        ${q.options.map((option, i) => `
                            <label>
                                <input type="radio" name="q${index}" value="${option}" required>
                                ${option}
                            </label>
                        `).join('')}
                    </div>
                `;
                quizForm.appendChild(questionCard);
            });
        }
        
        // Funci√≥n para mostrar el overlay de carga
        function showLoading() {
            loadingOverlay.style.display = 'flex';
        }
        
        // Funci√≥n para ocultar el overlay de carga
        function hideLoading() {
            loadingOverlay.style.display = 'none';
        }

        // Funci√≥n para mostrar un modal personalizado
        function showModal(message) {
            modalMessage.textContent = message;
            modal.style.display = 'flex';
        }
        
        // Funci√≥n para ocultar un modal personalizado
        function hideModal() {
            modal.style.display = 'none';
        }
        
        // Eventos de los botones
        // Se corrige este evento para que el bot√≥n "Comenzar" vaya a la zona de estudio.
        document.getElementById('start-btn').addEventListener('click', () => {
            showView(studyZone);
            currentPage = 0; // Reinicia la p√°gina de estudio
            showStudyPage(currentPage);
        });

        prevBtn.addEventListener('click', () => {
            if (currentPage > 0) {
                currentPage--;
                showStudyPage(currentPage);
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentPage < totalPages - 1) {
                currentPage++;
                showStudyPage(currentPage);
            }
        });

        goToEvaluationBtn.addEventListener('click', () => {
            showView(evaluationForm);
        });
        
        modalCloseBtn.addEventListener('click', () => {
            hideModal();
        });

        document.getElementById('registro-form').addEventListener('submit', (e) => {
            e.preventDefault();
            studentName = document.getElementById('student-name').value;
            studentGrade = document.getElementById('student-grade').value;
            studentId = document.getElementById('identification-number').value;
            
            generateQuiz();
            showView(quizZone);
        });

        document.getElementById('submit-quiz-btn').addEventListener('click', () => {
            const allAnswered = questions.every((q, index) => {
                const radios = document.querySelectorAll(`input[name="q${index}"]:checked`);
                return radios.length > 0;
            });

            if (!allAnswered) {
                showModal('¬°Por favor, responde todas las preguntas antes de enviar!');
                return;
            }

            let score = 0;
            questions.forEach((q, index) => {
                const selectedOption = document.querySelector(`input[name="q${index}"]:checked`).value;
                const isCorrect = selectedOption === q.correctAnswer;
                if (isCorrect) {
                    score++;
                }

                // A√±adir feedback a la pregunta
                const questionCard = document.querySelectorAll('.question-card')[index];
                questionCard.classList.add(isCorrect ? 'correct' : 'incorrect');

                const feedbackDiv = document.createElement('div');
                feedbackDiv.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
                feedbackDiv.innerHTML = `<p>${isCorrect ? '¬°Correcto!' : 'Incorrecto.'} La respuesta correcta es: <b>${q.correctAnswer}</b>.</p>`;
                questionCard.appendChild(feedbackDiv);

                // Deshabilitar las opciones para evitar cambios
                questionCard.querySelectorAll('input').forEach(input => input.disabled = true);
            });
            
            // Scroll to the top of the quiz zone to show the feedback
            quizZone.scrollIntoView({ behavior: 'smooth' });

            // Deshabilitar el bot√≥n de enviar
            document.getElementById('submit-quiz-btn').style.display = 'none';
            
            // Crear y mostrar el bot√≥n para ver la nota final
            const seeResultsBtn = document.createElement('button');
            seeResultsBtn.id = 'see-results-btn';
            seeResultsBtn.className = 'btn';
            seeResultsBtn.textContent = 'Ver Nota Final';
            seeResultsBtn.style.marginTop = '2rem';
            quizZone.appendChild(seeResultsBtn);
            
            seeResultsBtn.addEventListener('click', () => {
                checkAndSubmitResults(studentName, studentGrade, studentId, score);
            });
        });

        // Este es el evento para el bot√≥n "Volver al Inicio"
        document.getElementById('new-evaluation-btn').addEventListener('click', () => {
            // Reinicia los campos del formulario y el estado para un nuevo estudiante
            document.getElementById('registro-form').reset();
            // Llama a la funci√≥n showView para volver a la pantalla de inicio
            showView(startScreen);
        });

        // La URL de tu Google Apps Script (¬°DEBES PEGARLA AQU√ç!)
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxIhw0ygB2yG3KPEz85tCSz4cEKhtRvHCZXeReXvT03mIU5H4CEAXm27f9qqGaj5ct0/exec';

        async function checkAndSubmitResults(name, grade, id, score) {
            if (SCRIPT_URL === 'https://script.google.com/macros/s/AKfycbxIhw0ygB2yG3KPEz85tCSz4cEKhtRvHCZXeReXvT03mIU5H4CEAXm27f9qqGaj5ct0/exec') {
                console.error("Error: Por favor, actualiza la variable 'SCRIPT_URL' con la URL de tu Google Apps Script. Los datos no se enviar√°n.");
                showModal("Error de configuraci√≥n: La URL del Google Apps Script no est√° configurada. Los datos no se enviar√°n.");
                // Mostrar la pantalla de resultados de todos modos
                finalScoreSpan.textContent = score;
                if (score >= 8) {
                    scoreMessage.textContent = '¬°Excelente trabajo! üéâ Eres un experto en la c√©lula.';
                } else if (score >= 5) {
                    scoreMessage.textContent = '¬°Buen intento! üí™ Con un poco m√°s de estudio, ¬°lo lograr√°s!';
                } else {
                    scoreMessage.textContent = '¬°√Ånimo! Sigue estudiando la zona de aprendizaje para mejorar. ¬°T√∫ puedes! üöÄ';
                }
                showView(resultsScreen);
                return;
            }

            showLoading();

            try {
                // Paso 1: Verificar si el ID ya existe
                const checkUrl = `${SCRIPT_URL}?action=checkDuplicate&id=${encodeURIComponent(id)}`;
                const checkResponse = await fetch(checkUrl, { method: 'GET' });
                const checkResult = await checkResponse.json();

                if (checkResult.isDuplicate) {
                    hideLoading();
                    showModal("Error: Este n√∫mero de identificaci√≥n ya ha sido registrado. Cada estudiante puede realizar la evaluaci√≥n una sola vez.");
                    return;
                }

                // Paso 2: Si el ID no existe, enviar los resultados
                const formData = new FormData();
                formData.append('name', name);
                formData.append('grade', grade);
                formData.append('id', id);
                formData.append('score', score);
                formData.append('action', 'submitData'); // Acci√≥n para el Apps Script

                const submitResponse = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData,
                });
                const submitResult = await submitResponse.json();

                if (submitResult.status !== 'success') {
                    throw new Error('El servidor respondi√≥ con un error al guardar los datos.');
                }

                // Mostrar la pantalla de resultados despu√©s de guardar
                hideLoading();
                finalScoreSpan.textContent = score;
                if (score >= 8) {
                    scoreMessage.textContent = '¬°Excelente trabajo! üéâ Eres un experto en la c√©lula.';
                } else if (score >= 5) {
                    scoreMessage.textContent = '¬°Buen intento! üí™ Con un poco m√°s de estudio, ¬°lo lograr√°s!';
                } else {
                    scoreMessage.textContent = '¬°√Ånimo! Sigue estudiando la zona de aprendizaje para mejorar. ¬°T√∫ puedes! üöÄ';
                }
                showView(resultsScreen);

            } catch (error) {
                console.error('Error al procesar los datos:', error);
                hideLoading();
                showModal("Hubo un error al enviar los datos. Por favor, int√©ntalo de nuevo m√°s tarde.");
            }
        }
    </script>
</body>
</html>
